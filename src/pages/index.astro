---
import Layout from '../components/Layout.astro';
import Section from '../components/Section.astro';
import GigCard from '../components/GigCard.astro';
import PressListItem from '../components/PressListItem.astro';
import { getCollection } from 'astro:content';

// Get upcoming gigs (limit to 3)
const allGigs = await getCollection('gigs');
const upcomingGigs = allGigs
  .filter(gig => gig.data.isUpcoming)
  .sort((a, b) => new Date(a.data.date).getTime() - new Date(b.data.date).getTime())
  .slice(0, 3);

// Get latest press (limit to 3)
const allPress = await getCollection('press');
const latestPress = allPress
  .sort((a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime())
  .slice(0, 3);

// Get latest daily roundup
const allDaily = await getCollection('daily');
const latestDaily = allDaily
  .sort((a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime())[0];
---

<Layout title="Orange Whip - Surf Rock Instrumentals from Vancouver">
  <!-- Hero Section -->
  <Section className="bg-gradient-to-br from-orange-50 to-whip-50">
    <div class="text-center">
      <h1 class="text-5xl font-bold text-gray-900 mb-6">
        Orange Whip
      </h1>
      <p class="text-xl text-gray-600 mb-8 max-w-2xl mx-auto">
        Surf rock instrumentals that capture the spirit of the West Coast. 
        From Vancouver's shores to stages across BC.
      </p>
      <div class="flex justify-center space-x-4">
        <a href="/gigs" class="bg-orange-600 text-white px-6 py-3 rounded-lg hover:bg-orange-700 transition-colors">
          Upcoming Shows
        </a>
        <a href="/press" class="border border-orange-600 text-orange-600 px-6 py-3 rounded-lg hover:bg-orange-600 hover:text-white transition-colors">
          Latest News
        </a>
      </div>
    </div>
  </Section>

  <!-- Upcoming Shows -->
  {upcomingGigs.length > 0 && (
    <Section title="Upcoming Shows" subtitle="Don't miss our next performances">
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
        {upcomingGigs.map(gig => (
          <GigCard gig={gig} />
        ))}
      </div>
      <div class="text-center mt-8">
        <a href="/gigs" class="text-orange-600 hover:text-orange-700 font-medium">
          View All Shows →
        </a>
      </div>
    </Section>
  )}

  <!-- Latest Press -->
  <Section title="Latest Press" subtitle="What people are saying about Orange Whip">
    <div class="space-y-6">
      {latestPress.map(press => (
        <PressListItem press={press}>
          <p class="text-gray-600 line-clamp-2">
            {press.body.slice(0, 200)}...
          </p>
        </PressListItem>
      ))}
    </div>
    <div class="text-center mt-8">
      <a href="/press" class="text-orange-600 hover:text-orange-700 font-medium">
        View All Press →
      </a>
    </div>
  </Section>

  <!-- What's On Today -->
  {latestDaily && (
    <Section title="What's On" subtitle="Vancouver show roundup">
      <div class="bg-white rounded-lg shadow-md p-6">
        <div class="flex justify-between items-center mb-4">
          <h3 class="text-xl font-semibold">
            Vancouver Shows - {new Date(latestDaily.data.date).toLocaleDateString('en-US', { 
              weekday: 'long', 
              year: 'numeric', 
              month: 'long', 
              day: 'numeric' 
            })}
          </h3>
          <a href="/daily" class="text-orange-600 hover:text-orange-700 font-medium">
            View All →
          </a>
        </div>
        
        {latestDaily.data.today.length > 0 && (
          <div class="mb-6">
            <h4 class="font-semibold text-gray-900 mb-2">Today</h4>
            <ul class="space-y-2">
              {latestDaily.data.today.map(event => (
                <li class="flex justify-between items-center">
                  <div>
                    <span class="font-medium">{event.title}</span>
                    <span class="text-gray-600 ml-2">— {event.venue}</span>
                  </div>
                  {event.url && (
                    <a href={event.url} target="_blank" rel="noopener noreferrer" class="text-orange-600 hover:text-orange-700 text-sm">
                      Tickets →
                    </a>
                  )}
                </li>
              ))}
            </ul>
          </div>
        )}

        {latestDaily.data.thisWeek.length > 0 && (
          <div>
            <h4 class="font-semibold text-gray-900 mb-2">This Week</h4>
            <ul class="space-y-2">
              {latestDaily.data.thisWeek.slice(0, 3).map(event => (
                <li class="flex justify-between items-center">
                  <div>
                    <span class="font-medium">{event.title}</span>
                    <span class="text-gray-600 ml-2">— {event.venue}</span>
                  </div>
                  {event.url && (
                    <a href={event.url} target="_blank" rel="noopener noreferrer" class="text-orange-600 hover:text-orange-700 text-sm">
                      Tickets →
                    </a>
                  )}
                </li>
              ))}
            </ul>
          </div>
        )}
      </div>
    </Section>
  )}
</Layout>

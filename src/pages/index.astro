---
import Layout from '../components/Layout.astro';
import { Header } from '../components/react/Header';
import { Hero } from '../components/react/Hero';
import { FeaturedContent } from '../components/react/FeaturedContent';
import { Footer } from '../components/react/Footer';
import { client } from '../lib/sanity';

// Fetch upcoming gigs from Sanity
const upcomingGigsQuery = `*[_type == "gig" && isUpcoming == true] | order(date asc) [0...3]`;
const upcomingGigs = await client.fetch(upcomingGigsQuery);

// Fetch latest press from Sanity
const latestPressQuery = `*[_type == "press"] | order(date desc) [0...3]`;
const latestPress = await client.fetch(latestPressQuery);

// For now, we'll keep the daily content from local files as the GitHub Action isn't set up yet.
import { getCollection } from 'astro:content';
const allDaily = await getCollection('daily');
const latestDaily = allDaily
  .sort((a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime())[0];
---

<Layout title="Orange Whip - Surf Rock Instrumentals from Vancouver">
  <Header client:load />
  <Hero client:load />
  <FeaturedContent 
    client:load
    upcomingGigs={upcomingGigs}
    latestPress={latestPress}
    latestDaily={latestDaily}
  />
  <Footer client:load />
</Layout>

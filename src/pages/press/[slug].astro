---
import Layout from '../../components/Layout.astro';
import { Header } from '../../components/react/Header';
import { Footer } from '../../components/react/Footer';
import { client, urlFor } from '../../lib/sanity';
import { PortableText } from 'astro-portabletext';

export async function getStaticPaths() {
  const pressQuery = `*[_type == "press" && defined(slug.current)]{"slug": slug.current}`;
  const pressItems = await client.fetch(pressQuery);
  return pressItems.map(item => ({
    params: { slug: item.slug },
  }));
}

const { slug } = Astro.params;
const pressQuery = `*[_type == "press" && slug.current == "${slug}"][0]`;
const item = await client.fetch(pressQuery);

const pressDate = new Date(item.date);
const formattedDate = pressDate.toLocaleDateString('en-US', {
  year: 'numeric',
  month: 'long',
  day: 'numeric'
});
---

<Layout title={`${item.title} â€” Orange Whip`} description={item.description}>
  <Header client:load />

  <main class="container-max section-padding">
    <div class="max-w-4xl mx-auto">
      <!-- Back to Press Link -->
      <div class="mb-8">
        <a href="/press" class="text-primary-400 hover:text-primary-300 transition-colors duration-200">
          &larr; Back to all press
        </a>
      </div>

      <!-- Press Header -->
      <div class="text-center mb-12">
        <h1 class="text-4xl sm:text-5xl font-display font-bold text-gradient mb-4">{item.title}</h1>
        <p class="text-lg text-secondary-400 mb-4">{formattedDate}</p>
        {item.tags && item.tags.length > 0 && (
          <div class="flex justify-center flex-wrap gap-2">
            {item.tags.map((tag: string) => (
              <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-secondary-800 text-primary-400">
                {tag}
              </span>
            ))}
          </div>
        )}
      </div>

      <!-- Hero Image -->
      {item.heroImage && (
        <div class="mb-12">
          <img 
            src={urlFor(item.heroImage).width(800).url()}
            alt={item.title}
            class="w-full max-w-3xl mx-auto rounded-lg shadow-lg border-4 border-secondary-800"
          />
        </div>
      )}

      <!-- Press Content -->
      {item.content &&
        <article class="prose prose-invert prose-lg max-w-none mx-auto">
          <PortableText value={item.content} />
        </article>
      }
    </div>
  </main>
  
  <Footer client:load />
</Layout>

---
import Layout from '../../components/Layout.astro';
import { Header } from '../../components/react/Header';
import { Footer } from '../../components/react/Footer';
import { GigsList } from '../../components/react/GigsList';
import { client } from '@/lib/sanity';
import groq from 'groq';
import type { SanityGig } from '@/types/sanity';

const upcomingGigs = await client.fetch<SanityGig[]>(groq`
  *[_type == "gig" && isUpcoming == true]
    | order(date asc) {
      _id,
      title,
      date,
      venue,
      city,
      description,
      isUpcoming,
      "slug": slug.current
    }
`);

const pastGigs = await client.fetch<SanityGig[]>(groq`
  *[_type == "gig" && (isUpcoming == false || !defined(isUpcoming))]
    | order(date desc) {
      _id,
      title,
      date,
      venue,
      city,
      description,
      isUpcoming,
      "slug": slug.current
    }
`);
---

<Layout title="Gigs â€” Orange Whip">
  <Header client:load />

  <main class="container-max section-padding">
    <!-- Upcoming Shows -->
    {upcomingGigs.length > 0 && (
      <section class="mb-16">
        <div class="text-center mb-12">
          <h1 class="text-4xl sm:text-5xl font-display font-bold text-gradient mb-4">Upcoming Shows</h1>
          <p class="text-xl text-secondary-300 max-w-2xl mx-auto">Don't miss our next performances</p>
        </div>
        <GigsList client:load gigs={upcomingGigs} />
      </section>
    )}

    <!-- Past Shows -->
    {pastGigs.length > 0 && (
      <section>
        <div class="text-center mb-12">
          <h2 class="text-4xl sm:text-5xl font-display font-bold text-gradient mb-4">Past Shows</h2>
          <p class="text-xl text-secondary-300 max-w-2xl mx-auto">A look back at our previous performances</p>
        </div>
        <GigsList client:load gigs={pastGigs} />
      </section>
    )}

    {upcomingGigs.length === 0 && pastGigs.length === 0 && (
      <section class="text-center py-24">
        <p class="text-2xl text-secondary-300">No shows scheduled at the moment.</p>
        <p class="text-lg text-secondary-400 mt-2">Check back soon for updates!</p>
      </section>
    )}
  </main>
  
  <Footer client:load />
</Layout>

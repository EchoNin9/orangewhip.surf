---
import Layout from '../components/Layout.astro';
import { Header } from '../components/react/Header';
import { Hero } from '../components/react/Hero';
import { FeaturedContent } from '../components/react/FeaturedContent';
import { Footer } from '../components/react/Footer';
import { getCollection } from 'astro:content';
import { client } from '@/lib/sanity';
import groq from 'groq';
import type { SanityGig, SanityPress } from '@/types/sanity';

const upcomingGigs = await client.fetch<SanityGig[]>(groq`
  *[_type == "gig" && isUpcoming == true]
    | order(date asc)[0...3] {
      _id,
      title,
      date,
      venue,
      city,
      description,
      "slug": slug.current
    }
`);

const latestPress = await client.fetch<SanityPress[]>(groq`
  *[_type == "press"]
    | order(date desc)[0...3] {
      _id,
      title,
      date,
      description,
      "slug": slug.current,
      "heroImage": heroImage{alt, asset->{url}}
    }
`);

// Get latest daily roundup from local content for now
const allDaily = await getCollection('daily');
const latestDaily = allDaily
  .sort((a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime())[0];
---

<Layout title="Orange Whip - Surf Rock Instrumentals from Vancouver">
  <Header client:load />
  <Hero client:load />
  <FeaturedContent 
    client:load
    upcomingGigs={upcomingGigs}
    latestPress={latestPress}
    latestDaily={latestDaily}
  />
  <Footer client:load />
</Layout>
